{"version":3,"sources":["../../../../src/server/lib/incremental-cache/file-system-cache.ts"],"names":["LRUCache","path","getDerivedTags","memoryCache","tagsManifest","FileSystemCache","constructor","ctx","fs","flushToDisk","serverDistDir","appDir","_appDir","revalidatedTags","maxMemoryCacheSize","max","length","value","JSON","kind","stringify","props","Error","data","body","html","pageData","tagsManifestPath","join","loadTagsManifest","parse","readFileSync","toString","err","version","items","setTags","key","tags","tag","keys","includes","push","mkdir","dirname","writeFile","console","warn","revalidateTag","revalidatedAt","Date","now","get","fetchCache","process","env","NEXT_RUNTIME","filePath","getFsPath","pathname","fileData","readFile","mtime","stat","meta","replace","cacheEntry","lastModified","getTime","headers","status","_","isAppPath","parsedData","set","cacheTags","tagsHeader","split","derivedTags","isStale","some","innerData","wasRevalidated","undefined","htmlPath"],"mappings":"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"}